# Test Resources Configuration
# Test Resources automatically provides Consul, Kafka, and Apicurio
micronaut:
  application:
    name: engine-kafka-test
  server:
    port: ${random.port}
  test-resources:
    enabled: true
    shared-server:
      enabled: true
  scheduling:
    enabled: false  # Disable scheduled tasks in tests

# Disable gRPC server for engine-kafka tests
grpc:
  server:
    enabled: false

# Ensure testcontainers are enabled
testcontainers:
  enabled: true

# Enable test resource containers
containers:
  hashicorp-consul:
    enabled: true
  apache-kafka:
    enabled: true
  apicurio:
    enabled: true

# Consul configuration for test environment
consul:
  client:
    enabled: true  # Required for ConsulClient bean creation
    # DO NOT set host/port here - they are provided by test resources
    registration:
      enabled: false  # Not needed for engine-kafka tests
    discovery:
      enabled: false  # Not needed for engine-kafka tests
  config:
    enabled: false  # Not loading config from Consul in tests

# Kafka configuration
kafka:
  enabled: true
  schema:
    registry:
      type: apicurio
  consumers:
    default:
      auto-offset-reset: earliest
      enable-auto-commit: false
  producers:
    default:
      acks: all
      retries: 3
  topics:
    config:
      partitions: 5
      replication-factor: 1
      retention-ms: 604800000  # 7 days
      max-message-bytes: 8388608  # 8MB
      compression-type: snappy
      compact-enabled: true

# Application configuration
app:
  config:
    cluster-name: test-cluster
    consul:
      key-prefixes:
        pipeline-clusters: pipeline/clusters
        schema-versions: pipeline/schema-versions
        whitelists: pipeline/whitelists
      watch-seconds: 5

# Logging
logger:
  levels:
    com.krickert.search.orchestrator.kafka: DEBUG
    io.micronaut.test: WARN
    io.micronaut.testresources: WARN
    org.testcontainers: WARN