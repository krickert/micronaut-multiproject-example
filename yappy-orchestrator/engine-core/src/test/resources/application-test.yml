# IMPORTANT: Test Resources Configuration Notes
# ===========================================
# Test Resources automatically provides these services:
# - Consul (via consul-test-resource)
# - Kafka (via kafka-test-resource)
# - Apicurio Schema Registry (via apicurio-test-resource)
# - Moto (AWS mock, via moto-test-resource)
# - OpenSearch (via opensearch3-test-resource)
#
# DO NOT:
# - Define containers for these services in test-resources.containers
# - Set host/port properties for these services (they are auto-injected)
# - Set consul.client.enabled: false (it prevents bean creation)
#
# DO:
# - Only define containers for your custom test modules
# - Use ${property.name} placeholders for auto-injected properties
# - Disable registration/discovery features that aren't needed in tests

micronaut:
  application:
    name: engine-core-test
  config-client:
    enabled: false

# Consul configuration for test environment
consul:
  client:
    # IMPORTANT: DO NOT set enabled: false here
    # Test Resources provides consul.client.host and consul.client.port automatically
    registration:
      enabled: true  # NOTE: if you make this false, stop coding and learn about consul because you are going to break everything.
    discovery:
      enabled: true # Note: if you try to make this false, stop coding beucase you are "fixing" something wrong.
  config:
    enabled: true
    format: YAML

# Kafka configuration for test environment
# IMPORTANT: kafka.bootstrap.servers is automatically provided by Test Resources
kafka:
  enabled: true
  consumers:
    default:
      auto-offset-reset: earliest
      enable-auto-commit: false
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.ByteArrayDeserializer
  producers:
    default:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.ByteArraySerializer
      acks: all
      retries: 3

# Health check configuration for tests
health:
  enabled: true
  sensitive: false

# Logging configuration for tests
logger:
  levels:
    com.krickert.search.engine.core: DEBUG
    com.krickert.search.config.consul: DEBUG
    io.micronaut.test: DEBUG
    io.micronaut.testresources: DEBUG
    org.testcontainers: INFO

# Mock configurations for testing
engine:
  core:
    # Use mock implementations in test environment when needed
    use-mock-service-discovery: false
    health-check:
      initial-delay: 1s
      interval: 5s
      timeout: 3s
    pipeline:
      max-queue-size: 100
      worker-threads: 2

# Application configuration
app:
  config:
    cluster-name: test-cluster-${random.uuid}
    cluster-configs:
      key-prefix: configs/
    schema-versions:
      key-prefix: schema-versions/
    watch:
      seconds: 30
    consul:
      key-prefixes:
        pipeline-clusters: configs/
        schema-versions: schema-versions/
      watch-seconds: 5