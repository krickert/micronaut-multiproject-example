micronaut:
  application:
    name: engine-core-test
  config-client:
    enabled: false

# Consul configuration for test environment
consul:
  client:
    registration:
      enabled: false  # Disable auto-registration in tests
    discovery:
      enabled: true
  config:
    enabled: true
    format: YAML

# Kafka configuration for test environment
kafka:
  enabled: true
  consumers:
    default:
      auto-offset-reset: earliest
      enable-auto-commit: false
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.ByteArrayDeserializer
  producers:
    default:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.ByteArraySerializer
      acks: all
      retries: 3

# Health check configuration for tests
health:
  enabled: true
  sensitive: false

# Logging configuration for tests
logger:
  levels:
    com.krickert.search.engine.core: INFO
    com.krickert.search.config.consul: WARN
    io.micronaut.test: WARN
    io.micronaut.testresources: WARN
    org.testcontainers: WARN

# Mock configurations for testing
engine:
  test-mode: true  # Enable test mode to use getServiceInstances instead of getHealthyServiceInstances
  cluster:
    name: ${app.config.cluster-name}
  test-data-buffer:
    enabled: true
    capacity: 100
    precision: 3
    sample-rate: 1.0
  core:
    # Use mock implementations in test environment when needed
    use-mock-service-discovery: false
    health-check:
      initial-delay: 1s
      interval: 5s
      timeout: 3s
    pipeline:
      max-queue-size: 100
      worker-threads: 2

# Application configuration
app:
  config:
    cluster-name: test-cluster-${random.uuid}
    cluster-configs:
      key-prefix: configs/
    schema-versions:
      key-prefix: schema-versions/
    consul:
      key-prefixes:
        pipeline-clusters: configs/
        schema-versions: schema-versions/
      watch-seconds: 1  # Use 1 second for fast testing

# Yappy configuration
yappy:
  cluster:
    name: ${app.config.cluster-name}
  engine:
    buffer:
      enabled: false
      capacity: 100
      precision: 10
      sampleRate: 0.1